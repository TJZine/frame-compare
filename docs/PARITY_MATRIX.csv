Feature,Legacy Location/Ref,Modern Module,Parity (Yes/Partial/No),Notes / Gaps,Suggested Fix/Owner/Size(S/M/L)
"[Runtime] RAM limit","legacy/compv4_improved.py L20-L25","frame_compare.py / src/vs_core.py",Yes,"`set_ram_limit` mirrors legacy `max_cache_size` guard before clip init.","Maintain; smoke-test via CLI fixture (Core, S)"
"[Naming] Prefer GuessIt","legacy/compv4_improved.py L52-L60","src/utils.py / frame_compare.py",Yes,"`prefer_guessit` flag forwards to parser and falls back to Anitopy when missing.","Add unit toggling GuessIt availability (Utils, S)"
"[Naming] Always full filename","legacy/compv4_improved.py L48-L60","frame_compare.py / src/utils.py",Yes,"`always_full_filename` toggles dedup so labels expand to full filenames when requested.","Retain regression in CLI tests (CLI, S)"
"[Naming] Duplicate label suffixing","legacy/compv4_improved.py L48-L60","frame_compare.py",Yes,"Version tags/index suffixes keep short labels unique just like legacy heuristics.","Monitor for mixed-case regressions (CLI, S)"
"[Overrides] Trim start (positive/negative)","legacy/compv4_improved.py L94-L112","frame_compare.py / src/vs_core.py",Yes,"Negative values prepend blanks; positives slice clip prior to analysis and capture.","Maintain with fixture covering blank-padding (Core, M)"
"[Overrides] Trim end","legacy/compv4_improved.py L113-L134","frame_compare.py / src/vs_core.py",Yes,"Positive and negative end trims translate to clip slicing and FFmpeg index adjustments.","Regression already covered; no action"
"[Overrides] change_fps fraction","legacy/compv4_improved.py L135-L162","frame_compare.py / src/vs_core.py",Yes,"[num, den] overrides pipe through to `AssumeFPS` before frame selection.","Add AssumeFPS assertion in vs_core tests (Core, S)"
"[Overrides] change_fps 'set' reference","legacy/compv4_improved.py L149-L162","frame_compare.py",Yes,"Reference clip marked on `set` and subsequent plans inherit its measured fps.","Covered via CLI test; monitor future variants"
"[Analysis] Analyze clip selection","legacy/compv4_improved.py L168-L210","frame_compare.py",Yes,"Name/index/release-group matching chooses analysis source just like legacy prompt.","Integration already in test suite"
"[Analysis] Frame count targets","legacy/compv4_improved.py L27-L45","src/analysis.py",Yes,"Dark/bright/motion counts drive quantile selection and dedupe order identical to legacy.","Maintain"
"[Analysis] User-selected frames","legacy/compv4_improved.py L37-L45","src/analysis.py",Yes,"User frames inject ahead of algorithmic picks and survive dedupe exactly as before.","Ensure docs emphasise precedence (Docs, S)"
"[Analysis] Random frames & seed","legacy/compv4_improved.py L46-L50","src/analysis.py",Yes,"Configurable count seeded via `random_seed` for deterministic reruns.","Property test verifying seed stability (Analysis, S)"
"[Analysis] Downscale height","legacy/compv4_improved.py L640-L676","src/analysis.py",Yes,"Clips resize to configured height with even-dimension guardrails like legacy.","Add HDR fixture once available (Analysis, M)"
"[Analysis] Step (every Nth frame)","legacy/compv4_improved.py L688-L716","src/analysis.py",Yes,"Frame indices stride by `step` while maintaining cache compatibility.","No action"
"[Analysis] Analyze in SDR","legacy/compv4_improved.py L650-L676","src/analysis.py / src/vs_core.py",Yes,"Tonemapping invoked when flag true, preserving HDR guard semantics.","Add tonemap regression with HDR sample (Analysis, L)"
"[Analysis] Quantile thresholds","legacy/compv4_improved.py L780-L809","src/analysis.py",Yes,"`use_quantiles`, `dark_quantile`, and `bright_quantile` feed percentile lookups before selection.","Maintain"
"[Analysis] Motion absolute diff toggle","legacy/compv4_improved.py L810-L838","src/analysis.py",Yes,"`motion_use_absdiff` swaps Prewitt for Expr abs-diff path as in legacy.","Add unit verifying Expr branch (Analysis, S)"
"[Analysis] Motion scenecut filter","legacy/compv4_improved.py L840-L870","src/analysis.py",Yes,"Quantile filter removes high-motion spikes when threshold > 0.","Consider golden test with synthetic scenecut (Analysis, M)"
"[Analysis] Screen separation & quarter gap","legacy/compv4_improved.py L587-L606","src/analysis.py",Yes,"`screen_separation_sec` enforces min gaps; motion uses quarter heuristic to mirror legacy spread.","Keep deterministic regression (Analysis, S)"
"[Analysis] Motion smoothing radius","legacy/compv4_improved.py L872-L910","src/analysis.py",Yes,"Moving average radius applied before motion ranking just like legacy smoothing.","Add edge-case test for short lists (Analysis, S)"
"[Analysis] Frame metrics caching toggle","legacy/compv4_improved.py L34-L37","frame_compare.py / src/analysis.py",Yes,"`save_frames_data` writes/reads JSON caches with config fingerprinting.","Integration hot/cold test already present"
"[Analysis] Cache filename","legacy/compv4_improved.py L144-L156","frame_compare.py / src/analysis.py",Yes,"Cache stored at `frame_data_filename` under input dir, matching legacy text file path.","Maintain"
"[Analysis] Cache fingerprint parity","legacy/compv4_improved.py L144-L210","src/analysis.py",Yes,"Release group, trim, fps, and config hash gates reuse as legacy string fingerprint did.","Monitor for new config fields (Analysis, S)"
"[Screenshots] Output directory name","legacy/compv4_improved.py L147-L154","frame_compare.py / src/screenshot.py",Yes,"Screenshots write under `directory_name` relative to input folder before optional cleanup.","Integration test already covers deletion"
"[Screenshots] Add frame info overlay","legacy/compv4_improved.py L1758-L1796","src/screenshot.py",Yes,"Pillow overlay replicates frame banner when enabled, guarded for optional dependency.","Future golden test once Pillow available (Screenshots, M)"
"[Screenshots] FFmpeg writer toggle","legacy/compv4_improved.py L44-L47","src/screenshot.py",Yes,"Trim-aware frame indices keep FFmpeg captures aligned with VapourSynth outputs.","Negative trim regression covered"
"[Screenshots] Compression level","legacy/compv4_improved.py L44-L47","src/screenshot.py",Yes,"Compression levels remapped to fpng/FFmpeg equivalents (0/1/2 -> fast/slow/uncompressed).","Maintain"
"[Screenshots] Upscale tallest clip","legacy/compv4_improved.py L1704-L1776","src/screenshot.py",Yes,"Global geometry planner aligns heights when `upscale` true, mirroring tallest-source scaling.","Regression test present"
"[Screenshots] Single resolution override","legacy/compv4_improved.py L1704-L1776","src/screenshot.py",Yes,"`single_res` enforces exact vertical height while respecting `upscale` flag.","Maintain"
"[Screenshots] Modulus crop","legacy/compv4_improved.py L1680-L1703","src/screenshot.py",Yes,"`plan_mod_crop` removes edge padding to achieve modulus-aligned dimensions like legacy fpng path.","Maintain"
"[Screenshots] Letterbox awareness","legacy/compv4_improved.py L1680-L1703","src/screenshot.py",Yes,"Dominant-axis detection preserves bars before cropping identical to legacy heuristics.","Add portrait fixture test (Screenshots, S)"
"[Screenshots] Filename pattern","legacy/compv4_improved.py L1730-L1757","src/screenshot.py",Yes,"Labels sanitized with `_prepare_filename`; optional frame numbers mimic legacy suffix scheme.","Keep"
"[Screenshots] Placeholder fallback","legacy/compv4_improved.py L1800-L1830","src/screenshot.py",Yes,"Writer failures log warning and emit placeholder bytes, matching legacy resilience.","Monitor logs for noise"
"[Slow.pics] Auto upload toggle","legacy/compv4_improved.py L1872-L1971","frame_compare.py / src/slowpics.py",Yes,"`auto_upload` drives REST flow identical to legacy automation.","Maintain"
"[Slow.pics] Collection metadata","legacy/compv4_improved.py L1200-L1350","src/slowpics.py",Yes,"Collection name, TMDB, public/hentai flags, and remove-after days forward to API payloads.","Add API schema test with sample payload (Slowpics, M)"
"[Slow.pics] Webhook registration & POST","legacy/compv4_improved.py L1972-L1980","src/slowpics.py",Yes,"Webhook registered then direct POST issued with retries like legacy guarantee.","Monitor retry/backoff tuning (Slowpics, M)"
"[Slow.pics] Browser/open & clipboard","legacy/compv4_improved.py L1950-L1971","frame_compare.py",Yes,"`open_in_browser` and optional `pyperclip` copy wrap legacy UX with graceful fallbacks.","Document optional deps (Docs, S)"
"[Slow.pics] URL shortcut & cleanup","legacy/compv4_improved.py L1982-L2000","frame_compare.py / src/slowpics.py",Yes,"`.url` shortcut emission and post-upload directory deletion match original housekeeping.","Maintain"
"[CLI] --input override","legacy/compv4_improved.py usage","frame_compare.py",Yes,"Command-line input path replaces config, enabling ad-hoc runs like dropping script in folder.","Regression test present"
"[CLI] Summary output","legacy/compv4_improved.py printing","frame_compare.py",Yes,"Rich-styled summary lists files, frames, output dir, and slow.pics URL akin to legacy printwrap output.","Consider width-aware wrapping later (CLI, M)"
"[CLI] Supported containers","legacy/compv4_improved.py top constants","frame_compare.py",Yes,"Same extension allowlist ensures identical discovery order via `os_sorted`.","Maintain"
