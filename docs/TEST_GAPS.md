| Area/Module | Missing Test | Type (unit/integration/golden) | How to implement (1â€“3 bullets) | Priority |
| --- | --- | --- | --- | --- |
| `frame_compare` CLI | Happy-path orchestration using sample clips and mocked VapourSynth/slow.pics | integration | - Patch `vs_core.init_clip`, `generate_screenshots`, and `upload_comparison` to deterministic fakes<br>- Run CLI via `CliRunner` with temp input dir<br>- Assert summary output and exit code 0 | P0 |
| `frame_compare` overrides | Verify `cfg.overrides` applied to clips (trim/fps) | unit | - Inject fake `vs_core.init_clip` capturing kwargs<br>- Provide config with trim/change_fps overrides<br>- Assert expected clip adjustments triggered | P0 |
| `src/config_loader` | Validate `_coerce_bool` and `change_fps` error paths for bad values | unit | - Feed TOML snippets with invalid booleans/fps lists<br>- Expect `ConfigError` messages covering offending keys | P1 |
| `src/analysis.select_frames` | Quantile vs fixed-band behaviour and fallback logging | unit | - Supply synthetic brightness/motion arrays to force thresholds<br>- Toggle `use_quantiles` False<br>- Assert frame picks change and fallback warning emitted | P1 |
| `src/analysis` caching | Persistence round-trip once implemented | golden | - Run selection writing metrics file<br>- Re-run with cached data and assert no recomputation/log message | P1 |
| `src/screenshot.generate_screenshots` | Placeholder fallback when writer raises generic exception | unit | - Monkeypatch `_save_frame_with_vapoursynth` to raise `RuntimeError`<br>- Ensure placeholder file exists and warning logged | P1 |
| `src/slowpics.upload_comparison` | Missing XSRF token and webhook failure handling | unit | - Use fake session without cookie<br>- Assert `SlowpicsAPIError` surfaces with context<br>- Add case where webhook endpoint returns 500 | P0 |
| `src/vs_core.process_clip_for_screenshot` | HDR detection via numeric props and missing libplacebo | unit | - Provide fake clip with HDR primaries/transfer codes<br>- Simulate missing `core.libplacebo` to assert `ClipProcessError` | P1 |
| `src/utils.parse_filename_metadata` | Respect `prefer_guessit=False` / `always_full_filename=False` combos | unit | - Force GuessIt failure and ensure Anitopy output used<br>- Verify labels shorten when config disables full filename | P1 |
| CI workflow | Cross-platform and Python version matrix smoke test | integration | - Extend GitHub Actions matrix to include Windows + Python 3.12<br>- Capture artifact of generated screenshots for manual inspection | P2 |
